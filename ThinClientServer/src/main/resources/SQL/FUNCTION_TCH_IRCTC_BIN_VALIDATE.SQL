CREATE OR REPLACE FUNCTION TCH_IRCTC_BIN_VALIDATE
(
  BINVAL IN VARCHAR2
) 

RETURN VARCHAR2 AS

V_PRESENT VARCHAR2(20):=NULL;
V_BIN VARCHAR2(15):=NULL;
V_BIN_LIMIT VARCHAR2(10):=NULL;

--DECLARE FOR GET CARD TYPE
  TYPE BINRANGE_TCH IS RECORD 
  (BIN_RANGE_LOW TCH_BINMAP.FRMBINNO%TYPE, 
  BIN_RANGE_HIGH TCH_BINMAP.TOBINNO%TYPE, 
      CARD_TYPE TCH_BINMAP.CARDTYPE%TYPE,
      SCHEME_CODE TCH_BINMAP.SCHEMECODE%TYPE,
      BIN_TYPE TCH_BINMAP.BINTYPE%TYPE);
      
  TYPE TCH_BINRANGE_TYPE IS TABLE OF BINRANGE_TCH;
  BIN_RANGES TCH_BINRANGE_TYPE;
  
  CURSOR BINS IS 
  SELECT FRMBINNO,TOBINNO,CARDTYPE,SCHEMECODE,BINTYPE FROM TCH_BINMAP;

BEGIN
--DBMS_OUTPUT.ENABLE (buffer_size => NULL);

IF V_PRESENT IS NULL THEN
       BEGIN
        V_BIN:=SUBSTR(BINVAL,0,TO_NUMBER(10));
        OPEN BINS;
          LOOP
            FETCH BINS BULK COLLECT INTO BIN_RANGES LIMIT 30000;
              FOR INDX IN 1..BIN_RANGES.LAST LOOP
                  BEGIN 
                    IF TO_NUMBER(BIN_RANGES(INDX).BIN_RANGE_HIGH) >= TO_NUMBER(V_BIN) AND TO_NUMBER(BIN_RANGES(INDX).BIN_RANGE_LOW) <= TO_NUMBER(V_BIN) THEN
                      V_PRESENT := 'B-'||BIN_RANGES(INDX).SCHEME_CODE||'-'|| BIN_RANGES(INDX).CARD_TYPE || '-'||BIN_RANGES(INDX).BIN_TYPE;
                    END IF;
                  END;
               END LOOP;
               EXIT WHEN BINS%NOTFOUND;
          END LOOP;
        CLOSE BINS;
      END;
    END IF;
 RETURN V_PRESENT;
END TCH_IRCTC_BIN_VALIDATE;